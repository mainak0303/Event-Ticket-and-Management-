<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8" />
  <meta http-equiv="X-UA-Compatible" content="IE=edge" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin - Events</title>

  <!-- Stylesheets -->
  <link href="/vendor/fontawesome-free/css/all.min.css" rel="stylesheet" />
  <link href="https://fonts.googleapis.com/css?family=Nunito:200,300,400,700,900" rel="stylesheet" />
  <link href="/css/sb-admin-2.min.css" rel="stylesheet" />
  <link href="/css/admin.css" rel="stylesheet" />
</head>

<body id="page-top">
  <div id="wrapper">
    <%- include('../partials/sidebar', { activePage: 'events' }) %>

      <div id="content-wrapper" class="d-flex flex-column">
        <div id="content">
          <%- include('../layouts/navbar', { event_organizer: event_organizer, success: success, error: error }) %>

            <div class="container-fluid">
              <h1 class="h3 mb-4 text-gray-800">All Events</h1>

              <div class="mb-3">
                <a href="/events/new" class="btn btn-primary">
                  <i class="fas fa-plus"></i> Add New Event
                </a>
              </div>

              

              <div class="card shadow mb-4">
                <div class="card-body">
                  <div class="table-responsive">
                    <form method="GET" action="/events" class="mb-4">
  <div class="form-row">
    <div class="col">
      <input type="text" name="location" class="form-control" placeholder="Location"
        value="<%= filters?.location || '' %>"/>
    </div>
    <div class="col">
      <input type="text" name="category" class="form-control" placeholder="Category"
        value="<%= filters?.category || '' %>"/>
    </div>
    <div class="col">
      <input type="text" name="subcategory" class="form-control" placeholder="Subcategory"
        value="<%= filters?.subcategory || '' %>"/>
    </div>
    <div class="col">
      <input type="date" name="date" class="form-control" placeholder="Date"
        value="<%= filters?.date || '' %>"/>
    </div>
    <div class="col">
      <input type="time" name="time" class="form-control" placeholder="Time"
        value="<%= filters?.time || '' %>"/>
    </div>
    <div class="col">
      <select name="status" class="form-control">
        <option value="">All Statuses</option>
        <option value="active" <%= filters?.status==='active' ? 'selected' : '' %>>Active</option>
        <option value="inactive" <%= filters?.status==='inactive' ? 'selected' : '' %>>Inactive</option>
      </select>
    </div>

    <div class="col">
      <button type="submit" class="btn btn-primary">Filter</button>
      <a href="/events" class="btn btn-secondary">Clear</a>
    </div>
  </div>
</form>

                    <table id="eventsTable" class="table table-bordered" width="100%" cellspacing="0">
                      <thead class="thead-dark">
                        <tr>
                          <th>S.No</th>
                          <th>Image</th>
                          <th>Title</th>
                          <th>Date</th>
                          <th>Time</th>
                          <th>Location</th>
                          <th>Category</th>
                          <th>SubCategory</th>
                          <th>Organizer</th>
                          <th>Ticket Tiers</th>
                          <th>Status</th>
                          <th>Actions</th>
                        </tr>
                      </thead>
                      <tbody>
                        <% let serial = 1; %>
                        <% events.forEach(event=> { %>
                          <tr data-id="<%= event._id %>">
                            <td><%= serial++ %></td>
                            <td>
                              <% if (event.banner) { %>
                                <img src="/uploads/<%= event.banner %>" alt="Banner"
                                  style="width: 70px; height: 50px; object-fit: cover; border-radius: 4px;">
                                <% } else { %>
                                  N/A
                                  <% } %>
                            </td>
                            <td>
                              <%= event.title %>
                            </td>
                            <td>
                              <%= new Date(event.date).toLocaleDateString('en-IN', { dateStyle: 'medium' }) %>
                            </td>
                            <td>
                              <%= event.time || '-' %>
                            </td>
                            <td>
                              <%= event.location || '-' %>
                            </td>
                            <td>
                              <%= event.category || '-' %>
                            </td>
                            <td>
                              <%= event.subcategory || '-' %>
                            </td>
                            <td>
                              <%= event.organizer || '-' %>
                            </td>
                            <td>
                              <% if (event.tiers && event.tiers.length) { %>
                                <ul class="list-unstyled mb-0">
                                  <% event.tiers.forEach(tier=> { %>
                                    <li>
                                      <strong>
                                        <%= tier.name %>:
                                      </strong> â‚¹<%= tier.price %> (Qty: <%= tier.quantityAvailable %>)
                                          <% if (tier.benefits && tier.benefits.length) { %>
                                            <br />
                                            <small>Benefits: <%= tier.benefits.join(', ') %></small>
            <% } %>
          </li>
        <% }) %>
      </ul>
    <% } else { %>
      No Tiers
    <% } %>
  </td>
  <td><%= event.status %></td>
  <td>
    <a href="/events/<%= event._id %>/edit" class="btn btn-sm btn-warning mb-1">
      <i class="fas fa-edit"></i> Edit
    </a>
    <form action="/events/<%= event._id %>?_method=DELETE" method="POST" style="display:inline;">
      <button type="submit" class="btn btn-sm btn-danger" onclick="return confirm(' Are you sure you want to delete this event?');">
                                                <i class="fas fa-trash"></i> Delete
                                                </button>
                                                </form>
                                                <% if (event.status==='active' ) { %>
                                                  <form action="/events/<%= event._id %>/deactivate" method="POST"
                                                    style="display:inline;">
                                                    <button type="submit"
                                                      class="btn btn-sm btn-secondary mt-1">Deactivate</button>
                                                  </form>
                                                  <% } else { %>
                                                    <form action="/events/<%= event._id %>/activate" method="POST"
                                                      style="display:inline;">
                                                      <button type="submit"
                                                        class="btn btn-sm btn-success mt-1">Activate</button>
                                                    </form>
                                                    <% } %>
                            </td>
                          </tr>

                          <% }) %>
                      </tbody>
                    </table>
                  </div>
                </div>
              </div>
            </div>

            <%- include('../partials/footer') %>
        </div>
      </div>
  </div>

  <a class="scroll-to-top rounded" href="#page-top"><i class="fas fa-angle-up"></i></a>

  <!-- Scripts -->
  <script src="/vendor/jquery/jquery.min.js"></script>
  <script src="/vendor/bootstrap/js/bootstrap.bundle.min.js"></script>
  <script src="/vendor/datatables/jquery.dataTables.min.js"></script>
  <script src="/vendor/datatables/dataTables.bootstrap4.min.js"></script>
  <script src="/js/sb-admin-2.min.js"></script>

  <script>
    $(document).ready(function () {
      $('#eventsTable').DataTable();

      // Auto-fade alerts
      setTimeout(() => {
        $(".alert").fadeOut('slow');
      }, 3000);
    });
  </script>
</body>

</html>